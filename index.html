<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>notebooklm.directory</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00ff88',
            dark: {
              900: '#0a0a0a',
              800: '#1a1a2e',
              700: '#16213e',
            },
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        },
      },
    }
  </script>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Discover innovative NotebookLM projects, share your own work, and connect with a community of researchers and creators.">
  <meta property="og:title" content="notebooklm.directory">
  <meta property="og:description" content="The premier platform for NotebookLM exploration.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://notebooklm.directory">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body class="bg-dark-900 text-white font-sans">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-dark-900/70 backdrop-blur-xl border-b border-primary/10 shadow-lg">
    <nav class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold flex items-center gap-3">
        <span class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 px-3 py-2 rounded-lg text-sm font-bold tracking-wider font-mono">NLM_D</span>
        notebooklm<span class="text-primary">.directory</span>
      </a>
      
      <div class="hidden md:flex items-center gap-6">
        <a href="index.html" class="text-gray-200 hover:text-primary transition-colors">Home</a>
        <a href="#" class="text-gray-200 hover:text-primary transition-colors" id="browseLink">Browse</a>
        <a href="#" class="text-gray-200 hover:text-primary transition-colors">About</a>
        <button id="submitBtn" class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 font-bold py-2 px-4 rounded-lg hover:shadow-lg hover:shadow-primary/30 transition-all transform hover:-translate-y-1">Submit Notebook</button>
      </div>
      
      <button id="mobileMenuBtn" class="md:hidden text-white text-xl">‚ò∞</button>
    </nav>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="hidden md:hidden bg-dark-800/95 backdrop-blur-xl w-full border-b border-primary/10 shadow-lg">
      <div class="flex flex-col p-4 gap-4">
        <a href="index.html" class="text-gray-200 hover:text-primary transition-colors py-2">Home</a>
        <a href="#" class="text-gray-200 hover:text-primary transition-colors py-2" id="mobileBrowseLink">Browse</a>
        <a href="#" class="text-gray-200 hover:text-primary transition-colors py-2">About</a>
        <button id="mobileSubmitBtn" class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 font-bold py-2 px-4 rounded-lg">Submit Notebook</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Hero Section -->
    <section id="heroSection" class="gradient-bg py-20 text-center">
      <div class="max-w-4xl mx-auto px-4">
        <h1 class="text-5xl md:text-6xl font-extrabold mb-4">
          The Premier NotebookLM<span class="text-primary">.Directory</span>
        </h1>
        <h2 class="text-2xl font-medium mb-6">
          Discover. Build. <span class="text-primary">Accelerate.</span>
        </h2>
        <p class="text-xl text-gray-200 mb-8 max-w-2xl mx-auto">
          Discover innovative NotebookLM projects, share your own work, and connect with a community of researchers and creators.
        </p>
        
        <!-- Search Bar -->
        <div class="max-w-xl mx-auto relative mb-12">
          <div class="flex items-center bg-white/5 border border-primary/20 rounded-2xl p-3">
            <span class="text-primary text-xl mx-3">üîç</span>
            <input 
              type="text" 
              id="searchInput"
              placeholder="Search notebooks, topics, or authors..." 
              class="flex-1 bg-transparent border-none outline-none text-white"
            >
            <button id="searchBtn" class="bg-primary text-dark-900 px-4 py-2 rounded-lg font-semibold">Search</button>
          </div>
        </div>
        
        <div class="flex gap-4 justify-center flex-wrap">
          <a href="#notebooks" class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 font-bold py-3 px-6 rounded-xl uppercase tracking-wider hover:shadow-lg hover:shadow-primary/30 transition-all transform hover:-translate-y-1">Browse Projects</a>
          <button id="heroSubmitBtn" class="bg-transparent text-white border border-white/30 py-3 px-6 rounded-xl uppercase tracking-wider hover:border-primary hover:text-primary transition-colors">Submit Project</button>
        </div>
      </div>
    </section>

    <!-- Notebooks Section -->
    <section id="notebooks" class="py-16">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-4xl font-bold mb-8 text-center">
          Featured <span class="text-primary">Notebooks</span>
        </h2>
        
        <!-- Filter Tabs -->
        <div class="flex justify-center gap-4 mb-12 flex-wrap">
          <button class="filter-tab active" data-filter="all">All</button>
          <button class="filter-tab" data-filter="Academic">Academic</button>
          <button class="filter-tab" data-filter="Business">Business</button>
          <button class="filter-tab" data-filter="Creative">Creative</button>
          <button class="filter-tab" data-filter="Research">Research</button>
          <button class="filter-tab" data-filter="Education">Education</button>
          <button class="filter-tab" data-filter="Personal">Personal</button>
        </div>
        
        <!-- Loading State -->
        <div id="loading" class="py-12 text-center">
          <div class="spinner"></div>
          <p class="mt-4 text-gray-300">Loading notebooks...</p>
        </div>
        
        <!-- Error State -->
        <div id="error" class="hidden py-12 text-center">
          <div class="text-4xl mb-4">‚ö†Ô∏è</div>
          <h3 class="text-2xl font-semibold mb-2">Something went wrong</h3>
          <p class="text-gray-300 mb-6" id="errorMessage">Failed to load notebooks.</p>
          <button id="retryBtn" class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 font-bold py-2 px-6 rounded-lg">Try Again</button>
        </div>
        
        <!-- Notebooks Grid -->
        <div id="notebooksGrid" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <!-- Notebooks will be inserted here by JavaScript -->
        </div>
        
        <!-- No Results -->
        <div id="noResults" class="hidden py-12 text-center">
          <div class="text-4xl mb-4">üîç</div>
          <h3 class="text-2xl font-semibold mb-2">No notebooks found</h3>
          <p class="text-gray-300 mb-6">Try adjusting your search or filter criteria.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Submit Notebook Modal -->
  <div id="submitModal" class="modal">
    <div class="modal-content">
      <div class="flex justify-between items-center mb-8">
        <h2 class="text-2xl font-bold text-white">
          Connect a New <span class="text-primary">Notebook</span>
        </h2>
        <button id="closeModal" class="text-2xl text-gray-300 hover:text-primary hover:bg-white/10 p-2 rounded-lg transition-colors">√ó</button>
      </div>
      
      <div id="submitError" class="hidden bg-red-900/20 border border-red-500/30 text-red-400 p-4 rounded-xl mb-6"></div>
      <div id="submitSuccess" class="hidden bg-primary/10 border border-primary/30 text-primary p-4 rounded-xl mb-6">
        Notebook submitted successfully!
      </div>
      
      <form id="submitForm">
        <div class="mb-6">
          <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Project Title *</label>
          <input 
            type="text" 
            name="title" 
            required 
            class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
            placeholder="Enter a descriptive title"
          >
        </div>
        
        <div class="mb-6">
          <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Description *</label>
          <textarea 
            name="description" 
            required 
            rows="3" 
            class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors resize-vertical"
            placeholder="Describe your project and insights"
          ></textarea>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Category *</label>
            <select 
              name="category" 
              required 
              class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
            >
              <option value="" class="bg-dark-800">Select category</option>
              <option value="Academic" class="bg-dark-800">Academic</option>
              <option value="Business" class="bg-dark-800">Business</option>
              <option value="Creative" class="bg-dark-800">Creative</option>
              <option value="Research" class="bg-dark-800">Research</option>
              <option value="Education" class="bg-dark-800">Education</option>
              <option value="Personal" class="bg-dark-800">Personal</option>
            </select>
          </div>
          
          <div>
            <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Tags</label>
            <input 
              type="text" 
              name="tags" 
              class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
              placeholder="AI, Research, etc. (comma separated)"
            >
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Author Name *</label>
            <input 
              type="text" 
              name="author" 
              required 
              class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
              placeholder="Your name"
            >
          </div>
          
          <div>
            <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">Institution</label>
            <input 
              type="text" 
              name="institution" 
              class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
              placeholder="University, Company, etc."
            >
          </div>
        </div>
        
        <div class="mb-6">
          <label class="block mb-2 font-semibold text-white uppercase text-sm tracking-wider">NotebookLM Share URL *</label>
          <input 
            type="url" 
            name="notebook_url" 
            required 
            class="w-full p-4 border border-white/20 rounded-xl bg-white/5 text-white focus:border-primary transition-colors"
            placeholder="https://notebooklm.google.com/notebook/..."
          >
        </div>
        
        <div class="flex justify-end gap-4 mt-6">
          <button 
            type="button" 
            id="cancelSubmit" 
            class="bg-transparent text-gray-300 border border-white/20 px-8 py-4 rounded-xl font-medium hover:border-primary hover:text-primary transition-colors"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            id="submitFormBtn"
            class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 px-8 py-4 rounded-xl font-bold uppercase tracking-wider hover:shadow-lg hover:shadow-primary/30 transition-all transform hover:-translate-y-1"
          >
            Create Notebook
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Notebook Detail Modal -->
  <div id="detailModal" class="modal">
    <div class="modal-content max-w-4xl">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-white" id="detailTitle">Notebook Title</h2>
        <button id="closeDetailModal" class="text-2xl text-gray-300 hover:text-primary hover:bg-white/10 p-2 rounded-lg transition-colors">√ó</button>
      </div>
      
      <div class="mb-6">
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="category-badge" id="detailCategory">Category</span>
          <span class="featured-badge hidden" id="detailFeatured">Featured</span>
        </div>
        
        <p class="text-gray-200 mb-6" id="detailDescription">Description loading...</p>
        
        <div class="flex flex-wrap gap-2 mb-6" id="detailTags">
          <!-- Tags will be inserted here -->
        </div>
        
        <div class="flex justify-between items-start border-t border-white/10 pt-4">
          <div>
            <div class="text-white font-semibold" id="detailAuthor">Author</div>
            <div class="text-gray-300 text-sm" id="detailInstitution">Institution</div>
          </div>
          
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-1 text-gray-300 text-sm">
              <span>üëÅÔ∏è</span>
              <span id="detailViews">0</span>
            </div>
            
            <div class="flex items-center gap-1 text-gray-300 text-sm">
              <span>‚ù§Ô∏è</span>
              <span id="detailSaves">0</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="flex justify-between gap-4">
        <a id="detailLink" href="#" target="_blank" class="bg-gradient-to-r from-primary to-primary/80 text-dark-900 px-6 py-3 rounded-xl font-bold text-center flex-1 hover:shadow-lg hover:shadow-primary/30 transition-all transform hover:-translate-y-1">
          Open Notebook
        </a>
        <button id="closeDetailBtn" class="bg-transparent text-gray-300 border border-white/20 px-6 py-3 rounded-xl font-medium hover:border-primary hover:text-primary transition-colors">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="gradient-bg py-12 mt-16 border-t border-primary/10">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">
        <div>
          <h3 class="text-primary mb-4 text-lg font-medium">notebooklm.directory</h3>
          <p class="text-gray-300 text-sm leading-relaxed">
            Building the future of AI research through community collaboration and environmental responsibility.
          </p>
        </div>
        
        <div>
          <h4 class="text-white mb-4 font-medium">Quick Links</h4>
          <div class="flex flex-col gap-3">
            <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Browse Projects</a>
            <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Submit Project</a>
            <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">About</a>
          </div>
        </div>
        
        <div>
          <h4 class="text-white mb-4 font-medium">Community</h4>
          <div class="flex flex-col gap-3">
            <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Support Us</a>
            <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Analytics</a>
            <a href="mailto:support@notebooklm.directory" class="text-gray-300 text-sm hover:text-primary transition-colors">Contact</a>
          </div>
        </div>
        
        <div>
          <h4 class="text-white mb-4 font-medium">Environmental Impact</h4>
          <div class="bg-primary/10 border border-primary/20 shadow-lg shadow-primary/10 rounded-xl p-4 text-sm backdrop-blur-md">
            <div class="text-primary font-semibold mb-2">Our Impact Today:</div>
            <div class="text-gray-300 text-xs leading-relaxed">
              ‚Ä¢ 47% reduction in redundant research<br>
              ‚Ä¢ $3.2M in computational costs saved<br>
              ‚Ä¢ 156T CO‚ÇÇ emissions prevented
            </div>
          </div>
        </div>
      </div>
      
      <div class="border-t border-primary/10 pt-8 flex justify-between items-center flex-wrap gap-4">
        <p class="text-gray-300 text-sm">
          ¬© 2025 notebooklm.directory. Empowering sustainable AI research.
        </p>
        
        <div class="flex gap-6">
          <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Privacy</a>
          <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Terms</a>
          <a href="#" class="text-gray-300 text-sm hover:text-primary transition-colors">Cookies</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Supabase configuration
    const SUPABASE_URL = 'https://ciwlmdnmnsymiwmschej.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpd2xtZG5tbnN5bWl3bXNjaGVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2OTQzNjMsImV4cCI6MjA2NzI3MDM2M30.Ri_L-EBOOIvTY3WnMd91oegjauObj76pS4JmVIr4yjw';
    
    // DOM elements
    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error');
    const errorMessageEl = document.getElementById('errorMessage');
    const notebooksGridEl = document.getElementById('notebooksGrid');
    const noResultsEl = document.getElementById('noResults');
    const retryBtn = document.getElementById('retryBtn');
    const submitBtns = [
      document.getElementById('submitBtn'), 
      document.getElementById('mobileSubmitBtn'),
      document.getElementById('heroSubmitBtn')
    ];
    const submitModal = document.getElementById('submitModal');
    const closeModalBtn = document.getElementById('closeModal');
    const cancelSubmitBtn = document.getElementById('cancelSubmit');
    const submitForm = document.getElementById('submitForm');
    const submitErrorEl = document.getElementById('submitError');
    const submitSuccessEl = document.getElementById('submitSuccess');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const filterTabs = document.querySelectorAll('.filter-tab');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const detailModal = document.getElementById('detailModal');
    const closeDetailModalBtn = document.getElementById('closeDetailModal');
    const closeDetailBtn = document.getElementById('closeDetailBtn');
    
    // Current filter
    let currentFilter = 'all';
    let allNotebooks = [];
    
    // Sample data as fallback
    const sampleNotebooks = [
      {
        id: '1',
        title: 'Climate Research Analysis with NotebookLM',
        description: 'Comprehensive analysis of 50+ climate research papers using NotebookLM to identify key trends and research gaps in climate science.',
        category: 'Academic',
        tags: ['Climate Science', 'Research', 'Environmental'],
        author: 'Dr. Sarah Chen',
        institution: 'Stanford University',
        notebook_url: 'https://notebooklm.google.com/notebook/example1',
        audio_overview_url: '/overview.mp3',
        featured: true,
        created_at: '2025-01-15T10:00:00Z',
        view_count: 1250,
        save_count: 89
      },
      {
        id: '2',
        title: 'AI Ethics Framework Development',
        description: 'Using NotebookLM to synthesize ethical guidelines from multiple AI research papers and policy documents.',
        category: 'Research',
        tags: ['AI Ethics', 'Policy', 'Framework'],
        author: 'Prof. Michael Rodriguez',
        institution: 'MIT',
        notebook_url: 'https://notebooklm.google.com/notebook/example2',
        featured: true,
        created_at: '2025-01-14T15:30:00Z',
        view_count: 892,
        save_count: 67
      },
      {
        id: '3',
        title: 'Startup Pitch Deck Analysis',
        description: 'Analyzing successful startup pitch decks to extract key patterns and success factors for entrepreneurs.',
        category: 'Business',
        tags: ['Entrepreneurship', 'Business Strategy', 'Startups'],
        author: 'Emma Thompson',
        institution: 'Y Combinator',
        notebook_url: 'https://notebooklm.google.com/notebook/example3',
        featured: false,
        created_at: '2025-01-13T09:15:00Z',
        view_count: 634,
        save_count: 45
      },
      {
        id: '4',
        title: 'Creative Writing Workshop Analysis',
        description: 'Using NotebookLM to analyze award-winning short stories and extract narrative techniques.',
        category: 'Creative',
        tags: ['Creative Writing', 'Literature', 'Storytelling'],
        author: 'James Wilson',
        institution: 'Independent Writer',
        notebook_url: 'https://notebooklm.google.com/notebook/example4',
        featured: false,
        created_at: '2025-01-12T14:20:00Z',
        view_count: 423,
        save_count: 32
      },
      {
        id: '5',
        title: 'Educational Curriculum Design',
        description: 'Designing computer science curriculum for high schools using NotebookLM to analyze effective learning materials.',
        category: 'Education',
        tags: ['Education', 'Curriculum', 'Computer Science'],
        author: 'Dr. Lisa Park',
        institution: 'UC Berkeley',
        notebook_url: 'https://notebooklm.google.com/notebook/example5',
        featured: false,
        created_at: '2025-01-11T11:45:00Z',
        view_count: 567,
        save_count: 41
      },
      {
        id: '6',
        title: 'Personal Finance Optimization',
        description: 'Using NotebookLM to analyze personal spending patterns and create customized financial planning recommendations.',
        category: 'Personal',
        tags: ['Personal Finance', 'Investment', 'Budgeting'],
        author: 'Alex Kim',
        institution: 'Personal Project',
        notebook_url: 'https://notebooklm.google.com/notebook/example6',
        featured: false,
        created_at: '2025-01-10T16:30:00Z',
        view_count: 789,
        save_count: 56
      }
    ];
    
    // Fetch notebooks from Supabase
    async function fetchNotebooks() {
      showLoading();
      
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/notebooks?select=*&order=created_at.desc`, {
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
          }
        });
        
        if (!response.ok) {
          throw new Error(`Failed to fetch notebooks: ${response.status} ${response.statusText}`);
        }
        
        const notebooks = await response.json();
        
        if (notebooks && notebooks.length > 0) {
          allNotebooks = notebooks;
          filterAndDisplayNotebooks();
        } else {
          // Fallback to sample data if no notebooks found
          allNotebooks = sampleNotebooks;
          filterAndDisplayNotebooks();
        }
      } catch (error) {
        console.error('Error fetching notebooks:', error);
        // Fallback to sample data on error
        allNotebooks = sampleNotebooks;
        filterAndDisplayNotebooks();
      }
    }
    
    // Filter and display notebooks
    function filterAndDisplayNotebooks() {
      let filteredNotebooks = [...allNotebooks];
      
      // Apply category filter
      if (currentFilter !== 'all') {
        filteredNotebooks = filteredNotebooks.filter(notebook => notebook.category === currentFilter);
      }
      
      // Check if we have results
      if (filteredNotebooks.length === 0) {
        showNoResults();
        return;
      }
      
      // Display filtered notebooks
      displayNotebooks(filteredNotebooks);
    }
    
    // Display notebooks in the grid
    function displayNotebooks(notebooks) {
      notebooksGridEl.innerHTML = '';
      
      notebooks.forEach(notebook => {
        const notebookEl = document.createElement('div');
        notebookEl.className = 'card p-6 flex flex-col h-full cursor-pointer';
        
        // Format tags for display
        const tagsHtml = notebook.tags && notebook.tags.length > 0 
          ? `<div class="flex flex-wrap gap-2 mb-4">
              ${notebook.tags.slice(0, 3).map(tag => `<span class="tag">${tag}</span>`).join('')}
              ${notebook.tags.length > 3 ? `<span class="text-gray-300 text-xs py-1">+${notebook.tags.length - 3} more</span>` : ''}
            </div>`
          : '';
        
        notebookEl.innerHTML = `
          <div class="relative">
            <span class="category-badge absolute top-0 left-0">${notebook.category}</span>
            ${notebook.featured ? '<span class="featured-badge absolute top-0 right-0">Featured</span>' : ''}
          </div>
          
          <div class="mt-8">
            <h3 class="text-xl font-bold text-white mb-3 leading-tight">${notebook.title}</h3>
            <p class="text-gray-300 text-sm mb-4 line-clamp-3">${notebook.description}</p>
            ${tagsHtml}
          </div>
          
          <div class="mt-auto pt-4 border-t border-white/10 flex justify-between items-center">
            <div>
              <div class="text-white font-semibold text-sm">${notebook.author}</div>
              ${notebook.institution ? `<div class="text-gray-300 text-xs">${notebook.institution}</div>` : ''}
            </div>
            
            <div class="flex items-center gap-3">
              <div class="flex items-center gap-1 text-gray-300 text-xs">
                <span>üëÅÔ∏è</span>
                <span>${notebook.view_count || 0}</span>
              </div>
              
              <div class="flex items-center gap-1 text-gray-300 text-xs">
                <span>‚ù§Ô∏è</span>
                <span>${notebook.save_count || 0}</span>
              </div>
            </div>
          </div>
        `;
        
        notebookEl.addEventListener('click', () => {
          showNotebookDetail(notebook);
        });
        
        notebooksGridEl.appendChild(notebookEl);
      });
      
      hideLoading();
      notebooksGridEl.classList.remove('hidden');
      noResultsEl.classList.add('hidden');
    }
    
    // Show notebook detail
    function showNotebookDetail(notebook) {
      // Set detail content
      document.getElementById('detailTitle').textContent = notebook.title;
      document.getElementById('detailCategory').textContent = notebook.category;
      document.getElementById('detailDescription').textContent = notebook.description;
      document.getElementById('detailAuthor').textContent = notebook.author;
      document.getElementById('detailInstitution').textContent = notebook.institution || '';
      document.getElementById('detailViews').textContent = notebook.view_count || 0;
      document.getElementById('detailSaves').textContent = notebook.save_count || 0;
      document.getElementById('detailLink').href = notebook.notebook_url;
      
      // Handle featured badge
      const featuredBadge = document.getElementById('detailFeatured');
      if (notebook.featured) {
        featuredBadge.classList.remove('hidden');
      } else {
        featuredBadge.classList.add('hidden');
      }
      
      // Set tags
      const tagsContainer = document.getElementById('detailTags');
      tagsContainer.innerHTML = '';
      
      if (notebook.tags && notebook.tags.length > 0) {
        notebook.tags.forEach(tag => {
          const tagEl = document.createElement('span');
          tagEl.className = 'tag';
          tagEl.textContent = tag;
          tagsContainer.appendChild(tagEl);
        });
      }
      
      // Update URL with query parameter
      const url = new URL(window.location);
      url.searchParams.set('id', notebook.id);
      window.history.pushState({}, '', url);
      
      // Show modal
      detailModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      // Track view (in a real app, this would call the Supabase API)
      console.log(`Viewed notebook: ${notebook.id}`);
    }
    
    // Show loading state
    function showLoading() {
      loadingEl.classList.remove('hidden');
      errorEl.classList.add('hidden');
      notebooksGridEl.classList.add('hidden');
      noResultsEl.classList.add('hidden');
    }
    
    // Hide loading state
    function hideLoading() {
      loadingEl.classList.add('hidden');
    }
    
    // Show error state
    function showError(message) {
      errorEl.classList.remove('hidden');
      loadingEl.classList.add('hidden');
      notebooksGridEl.classList.add('hidden');
      noResultsEl.classList.add('hidden');
      errorMessageEl.textContent = message || 'Failed to load notebooks.';
    }
    
    // Show no results state
    function showNoResults() {
      noResultsEl.classList.remove('hidden');
      loadingEl.classList.add('hidden');
      errorEl.classList.add('hidden');
      notebooksGridEl.classList.add('hidden');
    }
    
    // Modal functions
    function openSubmitModal() {
      submitModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      submitErrorEl.classList.add('hidden');
      submitSuccessEl.classList.add('hidden');
    }
    
    function closeSubmitModal() {
      submitModal.classList.remove('active');
      document.body.style.overflow = '';
      submitForm.reset();
    }
    
    function closeDetailModal() {
      detailModal.classList.remove('active');
      document.body.style.overflow = '';
      
      // Remove id from URL
      const url = new URL(window.location);
      url.searchParams.delete('id');
      window.history.pushState({}, '', url);
    }
    
    // Toggle mobile menu
    function toggleMobileMenu() {
      mobileMenu.classList.toggle('hidden');
    }
    
    // Check for notebook ID in URL on page load
    function checkUrlForNotebookId() {
      const urlParams = new URLSearchParams(window.location.search);
      const notebookId = urlParams.get('id');
      
      if (notebookId) {
        // Find notebook by ID
        const notebook = allNotebooks.find(n => n.id === notebookId);
        
        if (notebook) {
          showNotebookDetail(notebook);
        }
      }
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      fetchNotebooks();
      
      // Set up filter tabs
      filterTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs
          filterTabs.forEach(t => t.classList.remove('active'));
          
          // Add active class to clicked tab
          tab.classList.add('active');
          
          // Update current filter
          currentFilter = tab.dataset.filter;
          
          // Apply filter
          filterAndDisplayNotebooks();
        });
      });
    });
    
    retryBtn.addEventListener('click', fetchNotebooks);
    
    submitBtns.forEach(btn => {
      if (btn) btn.addEventListener('click', openSubmitModal);
    });
    
    closeModalBtn.addEventListener('click', closeSubmitModal);
    cancelSubmitBtn.addEventListener('click', closeSubmitModal);
    
    closeDetailModalBtn.addEventListener('click', closeDetailModal);
    closeDetailBtn.addEventListener('click', closeDetailModal);
    
    mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    
    submitForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      submitErrorEl.classList.add('hidden');
      submitSuccessEl.classList.add('hidden');
      
      const formData = new FormData(submitForm);
      const notebookData = {
        title: formData.get('title'),
        description: formData.get('description'),
        category: formData.get('category'),
        tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()) : [],
        author: formData.get('author'),
        institution: formData.get('institution') || null,
        notebook_url: formData.get('notebook_url'),
        featured: false
      };
      
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/notebooks`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify(notebookData)
        });
        
        if (!response.ok) {
          throw new Error(`Failed to submit notebook: ${response.status} ${response.statusText}`);
        }
        
        const newNotebook = await response.json();
        
        // Show success message
        submitSuccessEl.classList.remove('hidden');
        
        // Add the new notebook to our data
        allNotebooks = [newNotebook[0], ...allNotebooks];
        
        // Refresh the display
        setTimeout(() => {
          filterAndDisplayNotebooks();
          submitForm.reset();
          
          // Close modal after a delay
          setTimeout(() => {
            closeSubmitModal();
          }, 1500);
        }, 1000);
      } catch (error) {
        console.error('Error submitting notebook:', error);
        submitErrorEl.textContent = `Error: ${error.message}`;
        submitErrorEl.classList.remove('hidden');
      }
    });
    
    searchBtn.addEventListener('click', () => {
      const query = searchInput.value.trim().toLowerCase();
      if (query) {
        // Filter notebooks by search query
        const searchResults = allNotebooks.filter(notebook => 
          notebook.title.toLowerCase().includes(query) ||
          notebook.description.toLowerCase().includes(query) ||
          notebook.author.toLowerCase().includes(query) ||
          (notebook.tags && notebook.tags.some(tag => tag.toLowerCase().includes(query)))
        );
        
        if (searchResults.length > 0) {
          displayNotebooks(searchResults);
        } else {
          showNoResults();
        }
      } else {
        // If search is empty, show all notebooks
        filterAndDisplayNotebooks();
      }
    });
    
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchBtn.click();
      }
    });
    
    // Handle browser back button
    window.addEventListener('popstate', () => {
      const urlParams = new URLSearchParams(window.location.search);
      const notebookId = urlParams.get('id');
      
      if (!notebookId) {
        closeDetailModal();
      }
    });
    
    // Check for notebook ID in URL on page load
    window.addEventListener('load', () => {
      setTimeout(checkUrlForNotebookId, 1000); // Delay to ensure notebooks are loaded
    });
  </script>
</body>
</html>